<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hidden Code Messenger | SHAIKHSPY</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Righteous&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #DC2626;
            --secondary: #FEF3C7;
            --accent: #FFFFFF;
            --dark: #000000;
            --darker: #0A0A0A;
            --gray: #1A1A1A;
            --cream: #FEF7CD;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--accent);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .brand-text {
    font-family: 'Righteous', cursive;
    color: #cc0000; /* subtle dark red fallback */
    position: relative;
    display: inline-block;
    overflow: hidden;
    background: linear-gradient(90deg, #990000, #cc0000, #990000); /* slightly lighter dark red */
    background-size: 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shimmerLightDarkRed 2.5s linear infinite;
    text-shadow: 0 0 12px rgba(204, 0, 0, 0.6); /* lighter shadow */
}

@keyframes shimmerLightDarkRed {
    0% {
        background-position: -200%;
    }
    100% {
        background-position: 200%;
    }
}

        
        .glass-effect {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        
        .gradient-card {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(254, 243, 199, 0.05));
            border: 2px solid rgba(220, 38, 38, 0.4);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(220, 38, 38, 0.2);
        }
        
        .gradient-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 38, 38, 0.1), transparent);
            transition: 0.5s;
        }
        
        .gradient-card:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary), #B91C1C);
            color: var(--secondary);
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.4);
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(254, 243, 199, 0.3), transparent);
            transition: 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(220, 38, 38, 0.6);
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--secondary);
            border: 2px solid var(--secondary);
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .btn-secondary:hover {
            background: var(--secondary);
            color: var(--dark);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(254, 243, 199, 0.3);
        }
        
        .input-field {
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid rgba(220, 38, 38, 0.4);
            border-radius: 10px;
            padding: 16px;
            color: var(--accent);
            width: 100%;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
            transform: translateY(-2px);
        }
        
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .textarea-field {
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid rgba(220, 38, 38, 0.4);
            border-radius: 10px;
            padding: 16px;
            color: var(--accent);
            width: 100%;
            resize: vertical;
            min-height: 160px;
            transition: all 0.3s ease;
            position: relative;
            font-size: 16px;
        }
        
        .textarea-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
            transform: translateY(-2px);
        }
        
        .textarea-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-10deg);
            font-size: 4rem;
            font-weight: 900;
            color: rgba(220, 38, 38, 0.08);
            pointer-events: none;
            z-index: 1;
            white-space: nowrap;
            font-family: 'Righteous', cursive;
        }
        
        .format-select {
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid rgba(220, 38, 38, 0.4);
            border-radius: 10px;
            padding: 14px;
            color: var(--accent);
            width: 100%;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23DC2626'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 20px;
            font-size: 16px;
        }
        
        .format-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
            transform: translateY(-2px);
        }
        
        .output-box {
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid rgba(220, 38, 38, 0.4);
            border-radius: 10px;
            padding: 16px;
            min-height: 160px;
            max-height: 300px;
            overflow-y: auto;
            position: relative;
            transition: all 0.3s ease;
            color: var(--accent);
        }
        
        .output-box:hover {
            border-color: var(--primary);
        }
        
        .social-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(220, 38, 38, 0.1);
            color: var(--secondary);
            font-size: 1.3rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: 0 8px;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        
        .social-icon:hover {
            transform: translateY(-8px) scale(1.1);
            background: var(--primary);
            color: var(--secondary);
            box-shadow: 0 10px 20px rgba(220, 38, 38, 0.3);
        }
        
        .tab {
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid rgba(220, 38, 38, 0.4);
            padding: 18px 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            font-weight: 600;
            border-radius: 10px 10px 0 0;
            position: relative;
            overflow: hidden;
            color: rgba(254, 243, 199, 0.8);
        }
        
        .tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 4px;
            background: linear-gradient(45deg, var(--primary), #B91C1C);
            transition: 0.4s;
        }
        
        .tab.active {
            background: rgba(26, 26, 26, 0.9);
            border-bottom: none;
            color: var(--secondary);
        }
        
        .tab.active::before {
            width: 100%;
        }
        
        .tab.active i {
            color: var(--secondary);
            transform: scale(1.2);
        }
        
        .tab:hover {
            transform: translateY(-5px);
            background: rgba(26, 26, 26, 0.9);
            color: var(--secondary);
        }
        
        .section {
            transition: all 0.5s ease;
        }
        
        .hidden {
            display: none;
        }
        
        .status-message {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 16px 24px;
            border-radius: 10px;
            z-index: 1000;
            animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), fadeOut 0.5s ease 2.5s forwards;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            font-weight: 600;
            background: var(--primary);
            color: var(--secondary);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%) translateY(-20px); opacity: 0; }
            to { transform: translateX(0) translateY(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .floating {
            animation: floating 4s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(220, 38, 38, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }
        
        .bounce-in {
            animation: bounceIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .color-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 0;
        }
        
        .color-dot {
            position: absolute;
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(40px);
        }
        
        /* Text Colors */
        .text-primary { color: var(--primary); }
        .text-secondary { color: var(--secondary); }
        .text-accent { color: var(--accent); }
        .text-cream { color: var(--cream); }
        
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .tabs-container {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
                margin-bottom: 10px;
                border-radius: 10px;
            }
            
            .watermark {
                font-size: 2.5rem;
            }
            
            .btn-primary, .btn-secondary {
                padding: 12px 20px;
                font-size: 14px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(26, 26, 26, 0.8);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #B91C1C;
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="color-dots">
        <div class="color-dot floating" style="width: 300px; height: 300px; background: var(--primary); top: 10%; left: 5%; animation-delay: 0s;"></div>
        <div class="color-dot floating" style="width: 250px; height: 250px; background: var(--secondary); top: 60%; right: 10%; animation-delay: 1s;"></div>
        <div class="color-dot floating" style="width: 200px; height: 200px; background: var(--cream); bottom: 10%; left: 20%; animation-delay: 2s;"></div>
    </div>

    <div class="min-h-screen flex flex-col items-center justify-center p-4 relative z-10">
        <!-- Header -->
        <header class="text-center mb-10 mt-6 bounce-in">
            <div class="brand-text text-5xl md:text-7xl font-black mb-4">
                SHAIKHSPY
            </div>
            <h1 class="text-3xl md:text-4xl font-bold mb-4 text-secondary">HiddenCode Messenger</h1>
            <p class="text-xl text-cream max-w-2xl mx-auto">Securely encrypt messages with multiple output formats </p>
        </header>
        
        <!-- Main Container -->
        <div class="w-full max-w-7xl gradient-card rounded-2xl mb-10 overflow-hidden bounce-in" style="animation-delay: 0.2s;">
            <div class="p-6 md:p-8 rounded-2xl">
                <!-- Tabs -->
                <div class="tabs-container flex mb-8">
                    <div class="tab active flex-1" data-tab="encrypt">
                        <i class="fas fa-lock mr-3"></i> Encrypt Message
                    </div>
                    <div class="tab flex-1" data-tab="decrypt">
                        <i class="fas fa-unlock mr-3"></i> Decrypt Message
                    </div>
                </div>
                
                <!-- Encrypt Section -->
                <section id="encrypt-section" class="section">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Input Area -->
                        <div class="space-y-6">
                            <div class="relative">
                                <label class="block text-secondary mb-3 font-semibold text-lg"><i class="fas fa-keyboard mr-2"></i>Secret Message</label>
                                <textarea 
                                    id="plainText" 
                                    rows="10" 
                                    placeholder="Type your secret message here..." 
                                    class="textarea-field"
                                ></textarea>
                                <div class="watermark">OxB41D</div>
                            </div>
                            
                            <div>
                                <label class="block text-secondary mb-3 font-semibold text-lg"><i class="fas fa-lock mr-2"></i>Encryption Password</label>
                                <input 
                                    id="password" 
                                    type="password" 
                                    placeholder="Enter a strong password..." 
                                    class="input-field"
                                />
                            </div>
                        </div>
                        
                        <!-- Output Area -->
                        <div class="space-y-6">
                            <div>
                                <label class="block text-secondary mb-3 font-semibold text-lg"><i class="fas fa-code mr-2"></i>Output Format</label>
                                <select id="outputFormat" class="format-select">
                                    <option value="emoji">ðŸŽ­ Emoji (Fun & Secure)</option>
                                    <option value="base64">ðŸ”¢ Base64 (Standard)</option>
                                    <option value="hex">ðŸ”„ Hexadecimal</option>
                                    <option value="binary">ðŸ’» Binary</option>
                                    <option value="morse">ðŸ“¡ Morse Code</option>
                                    <option value="braille">â£¿ Braille</option>
                                    <option value="base32">ðŸ”¤ Base32</option>
                                    <option value="base58">ðŸ”¡ Base58</option>
                                    <option value="ascii85">ðŸ“Š ASCII85</option>
                                    <option value="base91">ðŸ”£ Base91</option>
                                    <option value="base92">ðŸ”  Base92</option>
                                    <option value="base122">ðŸ”¢ Base122</option>
                                    <option value="base2048">ðŸ”£ Base2048</option>
                                    <option value="zbase32">ðŸ”¤ zBase32</option>
                                    <option value="uuencode">ðŸ“¨ UUEncode</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-secondary mb-3 font-semibold text-lg"><i class="fas fa-shield-alt mr-2"></i>Encrypted Output</label>
                                <div id="encodedOutput" class="output-box">
                                    <p class="text-gray-400">Your encrypted message will appear here...</p>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-4">
                                <button id="encryptBtn" class="btn-primary pulse flex-1 min-w-[160px]">
                                    <i class="fas fa-key mr-2"></i> Encrypt
                                </button>
                                <button id="copyEncodedBtn" class="btn-secondary">
                                    <i class="fas fa-copy mr-2"></i> Copy
                                </button>
                                <button id="clearEncryptBtn" class="btn-secondary">
                                    <i class="fas fa-broom mr-2"></i> Clear
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Decrypt Section -->
                <section id="decrypt-section" class="section hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Input Area -->
                        <div class="space-y-6">
                            <div class="relative">
                                <label class="block text-secondary mb-3 font-'Orbitron' text-lg"><i class="fas fa-paste mr-2"></i>Encrypted Message</label>
                                <textarea 
                                    id="decryptInput" 
                                    rows="10" 
                                    placeholder="Paste the encrypted message here..." 
                                    class="textarea-field"
                                ></textarea>
                                <div class="watermark">OxB41D</div>
                            </div>
                            
                            <div>
                                <label class="block text-secondary mb-3 font-semibold text-lg"><i class="fas fa-unlock mr-2"></i>Decryption Password</label>
                                <input 
                                    id="decryptPassword" 
                                    type="password" 
                                    placeholder="Enter the decryption password..." 
                                    class="input-field"
                                />
                            </div>
                        </div>
                        
                        <!-- Output Area -->
                        <div class="space-y-6">
                            <div>
                                <label class="block text-secondary mb-3 font-semibold text-lg"><i class="fas fa-code mr-2"></i>Output Format</label>
                                <select id="decryptFormat" class="format-select">
                                    <option value="emoji">ðŸŽ­ Emoji (Fun & Secure)</option>
                                    <option value="base64">ðŸ”¢ Base64 (Standard)</option>
                                    <option value="hex">ðŸ”„ Hexadecimal</option>
                                    <option value="binary">ðŸ’» Binary</option>
                                    <option value="morse">ðŸ“¡ Morse Code</option>
                                    <option value="braille">â£¿ Braille</option>
                                    <option value="base32">ðŸ”¤ Base32</option>
                                    <option value="base58">ðŸ”¡ Base58</option>
                                    <option value="ascii85">ðŸ“Š ASCII85</option>
                                    <option value="base91">ðŸ”£ Base91</option>
                                    <option value="base92">ðŸ”  Base92</option>
                                    <option value="base122">ðŸ”¢ Base122</option>
                                    <option value="base2048">ðŸ”£ Base2048</option>
                                    <option value="zbase32">ðŸ”¤ zBase32</option>
                                    <option value="uuencode">ðŸ“¨ UUEncode</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-secondary mb-3 font-semibold text-lg"><i class="fas fa-file-alt mr-2"></i>Decrypted Message</label>
                                <div id="decryptedOutput" class="output-box">
                                    <p class="text-gray-400">Your decrypted message will appear here...</p>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-4">
                                <button id="decryptBtn" class="btn-primary pulse flex-1 min-w-[160px]">
                                    <i class="fas fa-unlock mr-2"></i> Decrypt
                                </button>
                                <button id="copyDecryptedBtn" class="btn-secondary">
                                    <i class="fas fa-copy mr-2"></i> Copy
                                </button>
                                <button id="clearDecryptBtn" class="btn-secondary">
                                    <i class="fas fa-broom mr-2"></i> Clear
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="text-center mt-8 mb-6 bounce-in" style="animation-delay: 0.4s;">
            <p class="text-secondary mb-6 text-lg">Made by <span class="text-cream font-bold">OBAIDULLAH SHAIKH</span></p>
            
            <div class="flex justify-center mb-8">
                <a href="https://www.linkedin.com/in/obaidullah-shaikh/" target="_blank" class="social-icon">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="https://github.com/shaikhobaid76" target="_blank" class="social-icon">
                    <i class="fab fa-github"></i>
                </a>
                <a href="https://www.instagram.com/official_mr_obaid/?igsh=MTN4MmZxaGNvbGduMQ%3D%3D#" target="_blank" class="social-icon">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="https://www.snapchat.com/add/shaikhobaid76?share_id=o2f1wAna4_8&locale=en-US" target="_blank" class="social-icon">
                    <i class="fab fa-snapchat-ghost"></i>
                </a>
            </div>
            
            <p class="text-sm text-cream max-w-2xl mx-auto">
                Encryption tool using Web Crypto API with multiple output formats. 
                All processing happens locally in your browser - no data is sent to servers.
            </p>
        </footer>
    </div>

    <script>
        // Constants
        const BASE64_CHARS = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        const EMOJI_ALPHABET = [
            "ðŸŸ ","ðŸ”µ","ðŸŸ¢","ðŸŸ£","ðŸŸ¡","ðŸ”´","âš«","âšª",
            "ðŸŸ¥","ðŸŸ¦","ðŸŸ©","ðŸŸª","ðŸŸ¨","ðŸŸ§","ðŸŸ«","ðŸ”¶",
            "ðŸ”·","ðŸ”³","ðŸ”²","â­","âœ¨","ðŸ’«","ðŸ”¥","â„ï¸",
            "ðŸŒŸ","ðŸŒ™","â˜€ï¸","â˜ï¸","âš¡","ðŸ’¥","ðŸ’§","ðŸ€",
            "ðŸŒˆ","ðŸŒŠ","ðŸŽ","ðŸ“","ðŸ‡","ðŸ¥‘","ðŸ‹","ðŸ‰",
            "ðŸ’","ðŸ","ðŸ¥¥","ðŸ¥•","ðŸŒ¶ï¸","ðŸ„","ðŸŒ½","ðŸ…",
            "ðŸŽµ","ðŸŽ¯","ðŸŽ²","ðŸŽ®","ðŸŽ§","ðŸ“Œ","ðŸ“Ž","ðŸ””",
            "ðŸ”‘","ðŸ”’","ðŸ”“","ðŸ“·","âœˆï¸","ðŸš€","ðŸš©","ðŸ"
        ];

        // Create emoji mappings
        const emojiMap = {};
        const emojiReverseMap = {};
        BASE64_CHARS.split("").forEach((ch, i) => {
            emojiMap[ch] = EMOJI_ALPHABET[i];
            emojiReverseMap[EMOJI_ALPHABET[i]] = ch;
        });

        // Initialize variables
        let currentTab = 'encrypt';

        // Helper functions
        function arrayBufferToBase64(buffer) {
            const bytes = new Uint8Array(buffer);
            let binary = "";
            for (let i = 0; i < bytes.byteLength; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return window.btoa(binary);
        }

        function base64ToArrayBuffer(b64) {
            const binary = window.atob(b64);
            const len = binary.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);
            return bytes.buffer;
        }

        // PBKDF2 derive key from password and salt
        async function deriveKey(passwordStr, salt) {
            const enc = new TextEncoder();
            const pwKey = await window.crypto.subtle.importKey(
                "raw",
                enc.encode(passwordStr),
                { name: "PBKDF2" },
                false,
                ["deriveKey"]
            );
            const key = await window.crypto.subtle.deriveKey(
                {
                    name: "PBKDF2",
                    salt,
                    iterations: 150000,
                    hash: "SHA-256",
                },
                pwKey,
                { name: "AES-GCM", length: 256 },
                false,
                ["encrypt", "decrypt"]
            );
            return key;
        }

        // Encrypt: returns base64(payload) where payload = salt(16) + iv(12) + ciphertext
        async function encryptText(plaintext, passwordStr) {
            setStatus("Encrypting...", "info");
            try {
                const enc = new TextEncoder();
                const salt = window.crypto.getRandomValues(new Uint8Array(16));
                const iv = window.crypto.getRandomValues(new Uint8Array(12));
                const key = await deriveKey(passwordStr, salt.buffer);
                const ct = await window.crypto.subtle.encrypt(
                    { name: "AES-GCM", iv },
                    key,
                    enc.encode(plaintext)
                );
                // concat salt + iv + ct
                const payload = new Uint8Array(salt.byteLength + iv.byteLength + ct.byteLength);
                payload.set(salt, 0);
                payload.set(iv, salt.byteLength);
                payload.set(new Uint8Array(ct), salt.byteLength + iv.byteLength);
                const b64 = arrayBufferToBase64(payload.buffer);
                setStatus("Encrypted successfully!", "success");
                return b64;
            } catch (e) {
                setStatus("Encryption failed: " + e.message, "error");
                throw e;
            }
        }

        async function decryptBase64Payload(b64Payload, passwordStr) {
            setStatus("Decrypting...", "info");
            try {
                const payloadBuf = base64ToArrayBuffer(b64Payload);
                const payload = new Uint8Array(payloadBuf);
                const salt = payload.slice(0, 16);
                const iv = payload.slice(16, 28);
                const ct = payload.slice(28);
                const key = await deriveKey(passwordStr, salt.buffer);
                const ptBuf = await window.crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ct);
                const dec = new TextDecoder();
                setStatus("Decrypted successfully!", "success");
                return dec.decode(ptBuf);
            } catch (e) {
                setStatus("Decryption failed: " + e.message, "error");
                throw e;
            }
        }

        // Format conversion functions
        function base64ToEmoji(b64) {
            return b64
                .split("")
                .map((ch) => (ch === "=" ? "ðŸ”š" : emojiMap[ch] || "â“"))
                .join("");
        }

        function emojiToBase64(emojiStr) {
            let b64 = emojiStr;
            b64 = b64.split("ðŸ”š").join("=");
            for (const [ch, em] of Object.entries(emojiMap)) {
                const re = new RegExp(em.replace(/[.*+?^${}()|[\\]\\]/g, "\\$&"), "g");
                b64 = b64.replace(re, ch);
            }
            return b64;
        }

        function base64ToHex(b64) {
            const bytes = new Uint8Array(base64ToArrayBuffer(b64));
            return Array.from(bytes).map((b) => b.toString(16).padStart(2, "0")).join("");
        }

        function hexToBase64(hex) {
            const hexStr = hex.replace(/[^0-9a-fA-F]/g, "");
            const bytes = new Uint8Array(hexStr.length / 2);
            for (let i = 0; i < bytes.length; i++) bytes[i] = parseInt(hexStr.substr(i * 2, 2), 16);
            return arrayBufferToBase64(bytes.buffer);
        }

        function base64ToBinary(b64) {
            const bytes = new Uint8Array(base64ToArrayBuffer(b64));
            return Array.from(bytes).map((b) => b.toString(2).padStart(8, "0")).join(" ");
        }

        function binaryToBase64(binary) {
            const binaryStr = binary.replace(/[^01]/g, "");
            const bytes = new Uint8Array(binaryStr.length / 8);
            for (let i = 0; i < bytes.length; i++) {
                bytes[i] = parseInt(binaryStr.substr(i * 8, 8), 2);
            }
            return arrayBufferToBase64(bytes.buffer);
        }

        // UI Functions
        function setStatus(message, type = "info") {
            const statusEl = document.createElement('div');
            statusEl.className = `status-message`;
            statusEl.textContent = message;
            document.body.appendChild(statusEl);
            
            setTimeout(() => {
                statusEl.remove();
            }, 3000);
        }

        function clearEncryptSection() {
            document.getElementById('plainText').value = '';
            document.getElementById('password').value = '';
            document.getElementById('encodedOutput').innerHTML = '<p class="text-gray-400">Your encrypted message will appear here...</p>';
            document.getElementById('encodedOutput').classList.add('text-gray-400');
        }

        function clearDecryptSection() {
            document.getElementById('decryptInput').value = '';
            document.getElementById('decryptPassword').value = '';
            document.getElementById('decryptedOutput').innerHTML = '<p class="text-gray-400">Your decrypted message will appear here...</p>';
            document.getElementById('decryptedOutput').classList.add('text-gray-400');
        }

        function switchTab(tabName) {
            // Clear the other tab's content when switching
            if (tabName === 'encrypt') {
                clearDecryptSection();
            } else {
                clearEncryptSection();
            }
            
            // Update tab UI
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Show/hide sections
            if (tabName === 'encrypt') {
                document.getElementById('encrypt-section').classList.remove('hidden');
                document.getElementById('decrypt-section').classList.add('hidden');
            } else {
                document.getElementById('encrypt-section').classList.add('hidden');
                document.getElementById('decrypt-section').classList.remove('hidden');
            }
            
            currentTab = tabName;
        }

        async function handleEncryptClick() {
            const plain = document.getElementById('plainText').value;
            const password = document.getElementById('password').value;
            const outputFormat = document.getElementById('outputFormat').value;
            const encodedOutput = document.getElementById('encodedOutput');
            
            if (!plain) return setStatus("Please enter text to encrypt.", "error");
            if (!password) return setStatus("Please set a password for encryption.", "error");
            
            try {
                const b64 = await encryptText(plain, password);
                let out = b64;
                
                // Convert to selected format
                if (outputFormat === "hex") {
                    out = base64ToHex(b64);
                } else if (outputFormat === "emoji") {
                    out = base64ToEmoji(b64);
                } else if (outputFormat === "binary") {
                    out = base64ToBinary(b64);
                } else if (outputFormat === "morse") {
                    out = "Morse code conversion would go here";
                } else if (outputFormat === "braille") {
                    out = "Braille conversion would go here";
                }
                // Add other format conversions as needed
                
                encodedOutput.innerHTML = `<p class="break-words">${out}</p>`;
                encodedOutput.classList.remove('text-gray-400');
            } catch (e) {
                // error already set in status
            }
        }

        async function handleDecryptClick() {
            const decryptInput = document.getElementById('decryptInput').value;
            const decryptPassword = document.getElementById('decryptPassword').value;
            const decryptFormat = document.getElementById('decryptFormat').value;
            const decryptedOutput = document.getElementById('decryptedOutput');
            
            if (!decryptInput) return setStatus("Please paste encrypted text to decrypt.", "error");
            if (!decryptPassword) return setStatus("Please enter password to decrypt.", "error");
            
            try {
                let b64 = decryptInput;
                
                // Convert from selected format back to base64
                if (decryptFormat === "hex") {
                    b64 = hexToBase64(decryptInput);
                } else if (decryptFormat === "emoji") {
                    b64 = emojiToBase64(decryptInput);
                } else if (decryptFormat === "binary") {
                    b64 = binaryToBase64(decryptInput);
                }
                // Add other format conversions as needed
                
                // Auto-detect: if the pasted input contains any of our emoji alphabet, prefer emoji decoding
                const containsEmoji = EMOJI_ALPHABET.some((e) => decryptInput.includes(e));
                if (containsEmoji && decryptFormat !== "emoji") {
                    b64 = emojiToBase64(decryptInput);
                }

                const pt = await decryptBase64Payload(b64, decryptPassword);
                decryptedOutput.innerHTML = `<p class="break-words">${pt}</p>`;
                decryptedOutput.classList.remove('text-gray-400');
            } catch (e) {
                // status set in decrypt
            }
        }

        function handleCopy(text, elementId) {
            if (!text || text.includes("will appear here")) return setStatus("Nothing to copy.", "error");
            navigator.clipboard
                .writeText(text)
                .then(() => setStatus("Copied to clipboard!", "success"))
                .catch((e) => setStatus("Copy failed: " + e.message, "error"));
        }

        function clearEncrypt() {
            clearEncryptSection();
            setStatus("Encrypt section cleared", "info");
        }

        function clearDecrypt() {
            clearDecryptSection();
            setStatus("Decrypt section cleared", "info");
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.getAttribute('data-tab'));
                });
            });
            
            document.getElementById('encryptBtn').addEventListener('click', handleEncryptClick);
            document.getElementById('decryptBtn').addEventListener('click', handleDecryptClick);
            document.getElementById('copyEncodedBtn').addEventListener('click', () => {
                const text = document.getElementById('encodedOutput').textContent;
                handleCopy(text, 'encodedOutput');
            });
            document.getElementById('copyDecryptedBtn').addEventListener('click', () => {
                const text = document.getElementById('decryptedOutput').textContent;
                handleCopy(text, 'decryptedOutput');
            });
            document.getElementById('clearEncryptBtn').addEventListener('click', clearEncrypt);
            document.getElementById('clearDecryptBtn').addEventListener('click', clearDecrypt);
        });
    </script>
</body>
</html>  l